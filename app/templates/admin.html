<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Admin</title>

<nav style="margin-bottom:20px;">
  <a href="/" style="color:#81c784; margin-right:10px;">Inicio</a>
  <strong style="margin-right:10px;">Admin</strong>
</nav>
<hr>

<style>
body {
  font-family: monospace;
  background:#111;
  color:#eee;
  padding:16px;
}

h1 { color:#ffd54f; }
h2 { color:#4fc3f7; margin-top:20px; }

input, textarea, select, button {
  background:#222;
  color:#eee;
  border:1px solid #555;
  padding:6px;
  font-family: monospace;
}

textarea { width:100%; height:60px; }
button { cursor:pointer; }

.box {
  border:1px solid #333;
  padding:10px;
  margin-bottom:20px;
}
</style>
</head>

<body>

<h1>ADMIN</h1>

<!-- ================================================= -->
<!-- CREAR CATEGORÍA -->
<!-- ================================================= -->
<div class="box">
<h2>Crear categoría</h2>

<form method="post" action="/admin/category">
  <input name="name" placeholder="Nombre de categoría" required>
  <button>Crear</button>
</form>
</div>

<!-- ================================================= -->
<!-- CREAR SUBCATEGORÍA -->
<!-- ================================================= -->
<div class="box">
<h2>Crear subcategoría</h2>

<form method="post" action="/admin/subcategory">
  <select name="category_id" required>
    <option value="">Categoría</option>
    {% for c in categories %}
      <option value="{{ c.id }}">{{ c.name }}</option>
    {% endfor %}
  </select>

  <input name="name" placeholder="Nombre de subcategoría" required>
  <button>Crear</button>
</form>
</div>

<!-- ================================================= -->
<!-- CREAR PREGUNTA -->
<!-- ================================================= -->
<div class="box">
<h2>Crear pregunta</h2>

<form method="post" action="/admin/question">

  <select name="subcategory_id" required>
    <option value="">Subcategoría</option>
    {% for c in categories %}
      <optgroup label="{{ c.name }}">
        {% for s in c.subcategories %}
          <option value="{{ s.id }}">{{ s.name }}</option>
        {% endfor %}
      </optgroup>
    {% endfor %}
  </select>

  <textarea name="statement" placeholder="Enunciado (LaTeX permitido)" required></textarea>
  <input name="answer" placeholder="Respuesta directa (vacío si es lectura)">
  <button>Guardar pregunta</button>

</form>
</div>

<!-- ================================================= -->
<!-- AGREGAR ALTERNATIVA (SIN RECARGA) -->
<!-- ================================================= -->
<div class="box">
<h2>Agregar alternativa (lectura)</h2>

<select id="opt-question" required>
  <option value="">Pregunta</option>
  {% for c in categories %}
    {% for s in c.subcategories %}
      {% for q in s.questions %}
        <option value="{{ q.id }}">
          {{ c.name }} / {{ s.name }} → {{ q.statement[:40] }}
        </option>
      {% endfor %}
    {% endfor %}
  {% endfor %}
</select>

<textarea id="opt-text" placeholder="Texto de la alternativa" required></textarea>

<label>
  <input type="checkbox" id="opt-correct">
  Correcta
</label>

<br><br>
<button type="button" onclick="addOption()">Agregar alternativa</button>

<p id="opt-status" style="color:#81c784; display:none;">✔ Guardado</p>
</div>

<!-- ================================================= -->
<!-- ELIMINAR -->
<!-- ================================================= -->
<div class="box">
<h2>Eliminar</h2>

<!-- Eliminar alternativa -->
<form method="post" action="/admin/option/delete">
  <select name="option_id" required>
    <option value="">Alternativa</option>
    {% for c in categories %}
      {% for s in c.subcategories %}
        {% for q in s.questions %}
          {% for o in q.options %}
            <option value="{{ o.id }}">
              {{ c.name }} / {{ s.name }} → {{ o.text[:40] }}
            </option>
          {% endfor %}
        {% endfor %}
      {% endfor %}
    {% endfor %}
  </select>
  <button>Eliminar alternativa</button>
</form>

<br>

<!-- Eliminar pregunta -->
<form method="post" action="/admin/question/delete">
  <select name="question_id" required>
    <option value="">Pregunta</option>
    {% for c in categories %}
      {% for s in c.subcategories %}
        {% for q in s.questions %}
          <option value="{{ q.id }}">
            {{ c.name }} / {{ s.name }} → {{ q.statement[:40] }}
          </option>
        {% endfor %}
      {% endfor %}
    {% endfor %}
  </select>
  <button>Eliminar pregunta</button>
</form>

<br>

<!-- Eliminar subcategoría -->
<form method="post" action="/admin/subcategory/delete">
  <select name="subcategory_id" required>
    <option value="">Subcategoría</option>
    {% for c in categories %}
      {% for s in c.subcategories %}
        <option value="{{ s.id }}">
          {{ c.name }} / {{ s.name }}
        </option>
      {% endfor %}
    {% endfor %}
  </select>
  <button>Eliminar subcategoría</button>
</form>

<br>

<!-- Eliminar categoría -->
<form method="post" action="/admin/category/delete">
  <select name="category_id" required>
    <option value="">Categoría</option>
    {% for c in categories %}
      <option value="{{ c.id }}">{{ c.name }}</option>
    {% endfor %}
  </select>
  <button>Eliminar categoría</button>
</form>

</div>

<!-- ================================================= -->
<!-- SCRIPT: SOLO PARA ALTERNATIVAS -->
<!-- ================================================= -->
<script>
function addOption() {
  const question_id = document.getElementById("opt-question").value;
  const text = document.getElementById("opt-text").value;
  const is_correct = document.getElementById("opt-correct").checked;
  const status = document.getElementById("opt-status");

  if (!question_id || !text) return;

  fetch("/admin/option", {
    method: "POST",
    headers: {
      "Content-Type": "application/x-www-form-urlencoded"
    },
    body: new URLSearchParams({
      question_id: question_id,
      text: text,
      is_correct: is_correct ? "on" : ""
    })
  }).then(() => {
    document.getElementById("opt-text").value = "";
    document.getElementById("opt-correct").checked = false;

    status.style.display = "block";
    setTimeout(() => status.style.display = "none", 1200);
  });
}
</script>

</body>
</html>
