<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Entrenamiento</title>

<style>
  body {
    font-family: monospace;
    background:#0e0e0e;
    color:#eee;
    padding:20px;
  }

  nav a {
    color:#4fc3f7;
    text-decoration:none;
    margin-right:10px;
  }

  h1, h2 { color:#ffd54f; }

  input, button {
    background:#222;
    color:#eee;
    border:1px solid #555;
    font-family: monospace;
    padding:6px;
    margin-top:5px;
  }

  .ok  { color:#4caf50; }
  .bad { color:#f44336; }

  .box {
    margin-top:20px;
    padding:15px;
    border:1px solid #333;
  }

  .progress {
    color:#aaa;
    font-size:14px;
    margin-bottom:10px;
  }
</style>

<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>

<body>

<nav>
  <a href="/">Inicio</a>
  <a href="/admin">Admin</a>
</nav>

<hr>

<h1>ENTRENAMIENTO</h1>

<!-- RESULTADO BREVE -->
{% if result %}
<div class="box">
  {% if result.correct %}
    <p class="ok">✔ CORRECTO</p>
  {% else %}
    <p class="bad">✘ INCORRECTO</p>
    <p>Respuesta correcta: <b>{{ result.expected }}</b></p>
  {% endif %}
</div>
{% endif %}

<!-- PREGUNTA ACTUAL (si hay más) -->
{% if question %}
<div class="box">

  {% if progress %}
    <div class="progress">
      Pregunta {{ progress.current }} / {{ progress.total }}
    </div>
  {% endif %}

  {% if remaining_time is defined %}
    <div class="progress" id="timer"></div>
  {% endif %}

  <h2>Pregunta</h2>

  <div id="question">
    {{ question.statement }}
  </div>

  <form method="post" action="/play/answer">
    <input type="hidden" name="question_id" value="{{ question.id }}">
    <input type="hidden" name="subcategory_id" value="{{ subcategory_id }}">

    <input
      name="user_answer"
      required
      autofocus
      placeholder="Tu respuesta"
    >
    <br>
    <button>Responder</button>
  </form>

</div>
{% endif %}

<!-- RESUMEN FINAL -->
{% if summary %}
<div class="box">
  <h2>Resumen</h2>
  <ul>
    <li>Preguntas: {{ summary.attempts }}</li>
    <li>Aciertos: {{ summary.correct }}</li>
    <li>Errores: {{ summary.attempts - summary.correct }}</li>
    <li>
      Precisión:
      {{ (summary.correct / summary.attempts * 100) | round(2) }}%
    </li>
  </ul>

  <form method="get" action="/">
    <button>Volver al inicio</button>
  </form>
</div>
{% endif %}

<script>
MathJax.typesetPromise();
</script>

<script>
{% if remaining_time is defined %}
let remaining = {{ remaining_time }};
const timer = document.getElementById("timer");

if (timer && remaining > 0) {
  setInterval(() => {
    if (remaining <= 0) return;
    remaining--;
    const m = Math.floor(remaining / 60);
    const s = remaining % 60;
    timer.textContent =
      "Tiempo restante: " + m + ":" + s.toString().padStart(2,"0");
  }, 1000);
}
{% endif %}
</script>

</body>
</html>
